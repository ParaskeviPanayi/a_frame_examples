<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>360 Image with Compass</title>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
</head>
<body>
  <a-scene>
    <a-assets>
      <!-- Your 360 image asset -->
      <img id="image" src="materials/12.jpg">
    </a-assets>

    <!-- 360 image entity -->
    <a-sky src="#image"></a-sky>

    <!-- Camera -->
    <a-entity id="camera" camera look-controls>
      <!-- Compass entity -->
      <a-entity id="compass" compass-rotation rotation="0 0 0" position="0 0 -1">
        <a-entity id="compass-needle" geometry="primitive: cone; height: 0.1; radiusBottom: 0.02" material="color: #8B4513" position="0 0 -0.5"></a-entity>
        <!-- Compass base -->
        <a-cylinder radius="0.1" height="0.02" color="#4B0082" shadow="cast: true" position="0 0 -0.5"></a-cylinder>
      </a-entity>
    </a-entity>

    <!-- Lighting -->
    <a-light type="ambient" color="#FFF" intensity="0.5"></a-light>
    <a-light type="point" color="#FFF" intensity="0.8" position="2 4 3" cast-shadow="true"></a-light>
  </a-scene>

  <script>
    AFRAME.registerComponent('compass-rotation', {
      init: function () {
        const compassEntity = this.el;
        const cameraEntity = document.getElementById('camera');

        // Set compass entity to follow camera entity
        compassEntity.object3D.position.copy(cameraEntity.object3D.position);
        cameraEntity.object3D.add(compassEntity.object3D);

        this.rotateCompass();
        cameraEntity.addEventListener('componentchanged', this.rotateCompass.bind(this));
      },
      rotateCompass: function () {
        const compassNeedle = document.getElementById('compass-needle');
        if (compassNeedle) {
          const cameraRotation = document.getElementById('camera').getAttribute('rotation');
          const northDirection = (360 - cameraRotation.y) % 360; // Adjust for camera rotation
          compassNeedle.object3D.rotation.y = THREE.Math.degToRad(northDirection);
        }
      }
    });
  </script>
</body>
</html>
